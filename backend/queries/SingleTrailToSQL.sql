/*
This query is a proof of concept that one trail in the GEOJSON format can be
converted into SQL before trying the full file.
*/

-- The JSON document to convert, i.e., `@document`, contains an array with five users taken from the department of the Interior.
-- SET @filePath = 'C:\LU\CMSCSeniorProjects\Trans_TrailSegment.geojson';
SET @document = '[{"id":1,"type":"Feature","properties":{"OBJECTID":1,"permanentidentifier":"dc665981-e024-46c9-aecc-f5d652acaba3","name":"Scott Creek Hwt","namealternate":null,"trailnumber":"55303AB","trailnumberalternate":null,"sourcefeatureid":"1102019010602","sourcedatasetid":"{123F1D48-D171-44C0-B4DD-ECFF92213B7E}","sourcedatadecscription":"USFS Trails 10/2021","sourceoriginator":"U.S. Forest Service","loaddate":"2021-11-01T08:29:32.000","trailtype":"Terra Trail","hikerpedestrian":"Y","bicycle":"N","packsaddle":"N","atv":"N","motorcycle":"N","ohvover50inches":"N","snowshoe":"N","crosscountryski":"N","dogsled":null,"snowmobile":"N","nonmotorizedwatercraft":null,"motorizedwatercraft":null,"primarytrailmaintainer":"FS","nationaltraildesignation":null,"lengthmiles":0.27188279,"networklength":1.65612601,"SHAPE_Length":null,"trailtype_description":"Standard/Terra Trail","hikerpedestrian_description":"Yes","bicycle_description":"No","packsaddle_description":"No","atv_description":"No","motorcycle_description":"No","ohvover50inches_description":"No","snowshoe_description":"No","crosscountryski_description":"No","dogsled_description":"Undefined","snowmobile_description":"No","nonmotorizedwatercraft_description":"Undefined","motorizedwatercraft_description":"Undefined","primarytrailmaintainer_description":"US Forest Service","nationaltraildesignation_description":"Undefined"},"geometry":{"type":"LineString","coordinates":[[-89.06059277949225,45.76155426751046],[-89.06017697845124,45.761879307093295],[-89.05993314303498,45.76213726959287],[-89.05984597532677,45.76246519250901],[-89.05961776178543,45.762682408133685],[-89.05937432845252,45.7628709925084],[-89.05846891491224,45.76303972375814],[-89.05786616074654,45.76324904979947],[-89.05749298158042,45.76354456959069],[-89.05799272220463,45.764278091464575]]}},{"id":2,"type":"Feature","properties":{"OBJECTID":2,"permanentidentifier":"e8e9da34-48af-48e7-a4e1-539649bc31de","name":"Oak Island Trail","namealternate":null,"trailnumber":null,"trailnumberalternate":null,"sourcefeatureid":"APIS","sourcedatasetid":"{71B3E6CB-8546-42BA-B833-FC0A2B81E657}","sourcedatadecscription":"NPS Trails 11/2019","sourceoriginator":"National Park Service","loaddate":"2019-11-21T10:08:28.000","trailtype":"Terra Trail","hikerpedestrian":"Y","bicycle":"N","packsaddle":"N","atv":"N","motorcycle":"N","ohvover50inches":"N","snowshoe":"N","crosscountryski":"N","dogsled":"N","snowmobile":"N","nonmotorizedwatercraft":null,"motorizedwatercraft":null,"primarytrailmaintainer":"NPS","nationaltraildesignation":null,"lengthmiles":0.92480217,"networklength":10.83766917,"SHAPE_Length":null,"trailtype_description":"Standard/Terra Trail","hikerpedestrian_description":"Yes","bicycle_description":"No","packsaddle_description":"No","atv_description":"No","motorcycle_description":"No","ohvover50inches_description":"No","snowshoe_description":"No","crosscountryski_description":"No","dogsled_description":"No","snowmobile_description":"No","nonmotorizedwatercraft_description":"Undefined","motorizedwatercraft_description":"Undefined","primarytrailmaintainer_description":"National Park Service","nationaltraildesignation_description":"Undefined"},"geometry":{"type":"LineString","coordinates":[[-90.72771460815454,46.95792454482012],[-90.7278523071127,46.95772024482045],[-90.72786000711267,46.95771144482046],[-90.7282035081538,46.957457245862486],[-90.7282106081538,46.95742594586255],[-90.72827160711205,46.95726514586278],[-90.72829470711201,46.95724304586281],[-90.72837830711188,46.95724924586284],[-90.72838640711183,46.95723144690453],[-90.72843950711177,46.95721894586285],[-90.72890520711104,46.957142745862996],[-90.7289280081527,46.957129645863006],[-90.72895860711094,46.95710324586304],[-90.72898930711091,46.95707684586307],[-90.72906490711081,46.95703784586317],[-90.72908090711076,46.95702924586317],[-90.72912620815237,46.9570076458632],[-90.7291720071106,46.95697254482161],[-90.72998820606767,46.9568267448218],[-90.73001130606764,46.95682264482184],[-90.73059100710846,46.9565372458639],[-90.73059860710845,46.95653284482228],[-90.73063690710836,46.956520145863976],[-90.73066710710833,46.956507245863975],[-90.73097300710782,46.956382745864175],[-90.73104910710772,46.95637084586417],[-90.73119420710749,46.956319645864255],[-90.73124700710741,46.956275744822676],[-90.7345510060606,46.954464845867165],[-90.73523770605954,46.95411394690933],[-90.74503390187766,46.95519384690766]]}}]';

-- Extract ONLY important attributes to limit data complexity.
-- Works with multiple JSON objects in array!!
SELECT *
FROM JSON_TABLE(@document, '$[*]' COLUMNS ( -- If JSON only has one object & not array, change '$[*]' to '$'
    trail_number INT PATH '$.id',
    source TEXT PATH '$.properties.sourceoriginator',
    source_date DATETIME PATH '$.properties.loaddate',
    trail_name TEXT PATH '$.properties.name',
    distance DOUBLE PATH '$.properties.lengthmiles',
    hiking TEXT PATH '$.properties.hikerpedestrian',
    bicycle TEXT PATH '$.properties.bicycle',
    snowshoe TEXT PATH '$.properties.snowshoe',
    crosscountryski TEXT PATH '$.properties.crosscountryski',
    geographic_geometry TEXT PATH '$.geometry',	-- Conversion to geometric datatypes not working, and conversion to text receives null values
    geom LINESTRING PATH '$.geometry.coordinates'
    )) AS Trail;